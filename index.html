<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<title>Clicker Fullscreen</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #0e0e0e;
    overflow: hidden;
    color: white;
    font-family: Arial, sans-serif;
  }
  canvas {
    display: block;
    background: #181818;
  }
</style>
</head>
<body>

<canvas id="game" tabindex="1"></canvas>

<script>
// ================== SETTINGS ==================
const DEV_MODE = false; // laita false julkaisuun

const SAVE_KEY = "clicker_save_v3";

// ================== CANVAS SETUP ==================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// Automaattinen focus, jotta DEV cheate toimii
canvas.focus();
canvas.addEventListener("click", () => canvas.focus());

// ================== GAME STATE ==================
let points = 0;
let perClick = 1;
let autoPerSec = 0;

let prestigeLevel = 0;
let prestigeMultiplier = 1;

let lastTime = performance.now();

const button = {
  x: 0, // lasketaan loopissa
  y: 0,
  r: 60,
  pulse: 0
};

const upgrades = [
  { name: "+1 / click", baseCost: 10, cost: 10, type: "click" },
  { name: "+1 / sec", baseCost: 50, cost: 50, type: "auto" }
];

let floatingTexts = [];

// ================== UTILS ==================
function format(n) {
  if (n < 1000) return Math.floor(n).toString();
  const units = ["K","M","B","T","Qa","Qi"];
  let u = -1;
  while (n >= 1000 && u < units.length - 1) {
    n /= 1000;
    u++;
  }
  return n.toFixed(2) + units[u];
}

// ================== SAVE / LOAD ==================
function saveGame() {
  const data = {
    points, perClick, autoPerSec, prestigeLevel,
    upgrades: upgrades.map(u => u.cost)
  };
  localStorage.setItem(SAVE_KEY, JSON.stringify(data));
}

function loadGame() {
  const data = JSON.parse(localStorage.getItem(SAVE_KEY));
  if (!data) return;

  points = data.points;
  perClick = data.perClick;
  autoPerSec = data.autoPerSec;
  prestigeLevel = data.prestigeLevel || 0;
  prestigeMultiplier = 1 + prestigeLevel * 0.5;

  data.upgrades.forEach((c,i) => {
    if (upgrades[i]) upgrades[i].cost = c;
  });
}

// ================== INPUT ==================
canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  // MAIN BUTTON
  const dx = mx - button.x;
  const dy = my - button.y;
  if (Math.sqrt(dx*dx + dy*dy) < button.r) {
    const gain = perClick * prestigeMultiplier;
    points += gain;
    button.pulse = 1;

    floatingTexts.push({
      x: button.x,
      y: button.y,
      text: "+" + format(gain),
      life: 1
    });
    return;
  }

  // UPGRADES
  upgrades.forEach((u,i) => {
    const y = canvas.height * 0.65 + i * 50;
    if (mx > canvas.width*0.35 && mx < canvas.width*0.65 &&
        my > y && my < y + 40) {
      if (points >= u.cost) {
        points -= u.cost;
        u.cost = Math.floor(u.cost * 1.5);
        if (u.type === "click") perClick++;
        if (u.type === "auto") autoPerSec++;
      }
    }
  });

  // PRESTIGE
  const px = canvas.width*0.4;
  const py = canvas.height*0.85;
  const pw = canvas.width*0.2;
  const ph = 50;
  if (mx > px && mx < px + pw && my > py && my < py + ph) {
    if (points >= 1e6) doPrestige();
  }
});

// ================== PRESTIGE ==================
function doPrestige() {
  prestigeLevel++;
  prestigeMultiplier = 1 + prestigeLevel * 0.5;
  points = 0;
  perClick = 1;
  autoPerSec = 0;
  upgrades.forEach(u => u.cost = u.baseCost);
  saveGame();
}

// ================== UPDATE ==================
function update(dt) {
  points += autoPerSec * prestigeMultiplier * dt;

  button.pulse = Math.max(0, button.pulse - dt*3);

  floatingTexts.forEach(t => {
    t.y -= 50 * dt;
    t.life -= dt;
  });
  floatingTexts = floatingTexts.filter(t => t.life > 0);
}

// ================== DRAW ==================
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // HEADER
  ctx.fillStyle = "white";
  ctx.font = "24px Arial";
  ctx.fillText("Pisteet: " + format(points), 20, 40);
  ctx.fillText("Moninkertaistin: " + prestigeLevel + " (x" + prestigeMultiplier.toFixed(1) + ")", 20, 70);

  // BUTTON
  button.x = canvas.width/2;
  button.y = canvas.height/2;
  const scale = 1 + button.pulse*0.1;
  ctx.beginPath();
  ctx.arc(button.x, button.y, button.r*scale,0,Math.PI*2);
  ctx.fillStyle = "#00ff99";
  ctx.fill();

  ctx.fillStyle = "#000";
  ctx.font = "20px Arial";
  ctx.fillText("KLIKKAA", button.x-28, button.y+6);

  // FLOATING TEXTS
  ctx.font = "18px Arial";
  floatingTexts.forEach(t => {
    ctx.globalAlpha = t.life;
    ctx.fillStyle = "#000000";
    ctx.fillText(t.text, t.x-10, t.y);
    ctx.globalAlpha = 1;
  });

  // UPGRADES
  upgrades.forEach((u,i) => {
    const y = canvas.height*0.65 + i*50;
    const x = canvas.width*0.35;
    const w = canvas.width*0.3;
    const h = 40;
    ctx.fillStyle = "#333";
    ctx.fillRect(x, y, w, h);
    ctx.fillStyle = "white";
    ctx.fillText(`${u.name} (${format(u.cost)})`, x+10, y+25);
  });

  // PRESTIGE BUTTON
  const px = canvas.width*0.4;
  const py = canvas.height*0.85;
  const pw = canvas.width*0.2;
  const ph = 50;
  ctx.fillStyle = points >= 1e6 ? "#ff5555" : "#333";
  ctx.fillRect(px, py, pw, ph);
  ctx.fillStyle = "white";
  ctx.fillText("Moninkertaistus (1M)", px+15, py+32);

  // DEV MODE HUD
  if (DEV_MODE) {
    ctx.fillStyle = "yellow";
    ctx.font = "16px Arial";
    ctx.fillText("DEV MODE ON - Cheats: 1,2,3,C,A,P,R", 20, canvas.height-20);
  }
}

// ================== LOOP ==================
function loop(t) {
  const dt = (t - lastTime)/1000;
  lastTime = t;

  update(dt);
  draw();
  requestAnimationFrame(loop);
}

// ================== DEV CHEATS ==================
if (DEV_MODE) {
  window.addEventListener("keydown", e => {
    const key = e.key.toLowerCase();
    switch(key) {
      case "1": points += 1_000; break;
      case "2": points += 1_000_000; break;
      case "3": points += 1_000_000_000; break;
      case "c": perClick += 10; break;
      case "a": autoPerSec += 10; break;
      case "p": doPrestige(); break;
      case "r": localStorage.removeItem(SAVE_KEY); location.reload(); break;
    }
  });
}

// ================== START ==================
loadGame();
setInterval(saveGame,2000);
window.addEventListener("beforeunload", saveGame);
loop(lastTime);
</script>

</body>
</html>
